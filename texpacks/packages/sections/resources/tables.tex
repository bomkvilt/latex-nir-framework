\texcode{on}

% >> -----------------------------------------------------------------------------------------------
% >> init section environment
% 
% This document contains scripts that allow to create uniform tables along all the document with
% shorted number of command
% >> -----------------------------------------------------------------------------------------------

% create a new resource type
% #1 - resource group
% #2 - label prefix
% #3 - subpath
\@@sections@res@newResourceType{tabs}{tabs:}{/tabs}


% #1 - output valiable: tl
% #2 - caption function
% #3 - caption
% #4 - level's letter
% #5 - b use global label names
% #6 - short label's name
\cs_new_protected:Nn \@@sections@tabs@generateCaption:Nnnnnn
{
    \bool_if:nT {
        ! \tl_if_blank_p:n{#3} &&
        ! \tl_if_blank_p:n{#4} &&
        ! \tl_if_blank_p:n{#6}
    } {
        \tl_clear_new:N \@@@label
        \@@sections@res@makeLabel:Nnnnn \@@@label {tabs}{#4}{#5}{#6}
        \@@sections@tabs@generateCaption:NnnV #1 {#2}{#3}\@@@label
    }
}
\cs_new_protected:Nn \@@sections@tabs@generateCaption:Nnnn
{
    \tl_set:Nn #1 {#2{#3} \label{#4}}
}
\cs_generate_variant:Nn \@@sections@tabs@generateCaption:Nnnn {NnnV}


\newcommand{\@@sections@tabs@caption}[1]
{
    \captionof{table}{#1}
}


% reference a table
% r #1  - flag that represents a search directory 
%       p - part's    resources
%       s - section's resources
%       g - global resources
% s #2  - b use global label names
% m #3  - equation label
\NewDocumentCommand{\refTab}{ r<> s m }
{
    \@@sections@res@ref:nnnnn {tabs}{#1}{#2}{#3}{\c_novalue_tl}
}


% create a new table
% >> ----------------------------------| table topo
% O #1 - table width
% m #2 - columns pattern
% >> ----------------------------------| label
% d #3 - level's letter
% s #4 - b use global label names
% o #5 - short label's name
% o #6 - caption
% >> ----------------------------------| heads & foots
% G #7 - head code p. 1
% G #8 - head code p. 2+
% >>
\NewDocumentEnvironment{sectable}{ O{\textwidth} m d<> s O{} O{} G{} G{#7} }
{
    \tl_clear_new:N \@@@caption
    \@@sections@tabs@generateCaption:Nnnnnn \@@@caption {\caption}{#6}{#3}{#4}{#5}

    \xltabular{#1}{#2}
        \tl_use:N \@@@caption \\
        #7 \endfirsthead\hline
        #8 \endhead\hline
} 
{
    \endxltabular
    \bigskip
}

% create a new table
% >> ----------------------------------| table topo
% O #1 - table width
% m #2 - columns pattern
% >> ----------------------------------| label
% d #3 - level's letter
% s #4 - b use global label names
% O #5 - short label's name
% O #6 - caption
% >> ----------------------------------| table position
% O #7 - floating settings
% >>
\NewDocumentEnvironment{atomictable}{ O{\textwidth} m d<> s O{} O{} O{H}}
{
    \tl_clear_new:N \@@@caption
    \@@sections@tabs@generateCaption:Nnnnnn \@@@caption {\caption}{#6}{#3}{#4}{#5}
    
    \table[#7] 
        \tl_use:N \@@@caption
        \tabularx{#1}{#2}
} 
{
        \endtabularx
    \table
    \bigskip
}


\texcode{}
